# Raft算法常见名词及解释

1. **节点（Node）**：Raft集群中的服务器，可以是领导者（Leader）、候选者（Candidate）或追随者（Follower）。

2. **领导者（Leader）**：负责处理客户端的所有请求，并将日志条目复制到其他节点。例如，在一个三节点集群中，当一个节点被选为领导者后，它负责接收和处理所有客户端的请求。

3. **追随者（Follower）**：被动接收来自领导者的日志条目和心跳信息，并响应选举请求。例如，在三节点集群中，除领导者外的两个节点为追随者，它们接收和应用来自领导者的日志条目。

4. **候选者（Candidate）**：追随者在无法接收到领导者的心跳后，会发起选举成为候选者，并向其他节点请求投票。例如，当一个追随者在规定时间内没有接收到领导者的心跳消息时，它会变成候选者，发起选举。

5. **任期（Term）**：Raft算法中的时间分段，每个任期开始于一次选举，可能由一个或多个领导者组成。任期是递增的整数，例如，第一个任期是1，第二个任期是2，依此类推。

6. **日志条目（Log Entry）**：领导者记录的操作指令，用于状态机复制，每个日志条目包含一个命令和对应的任期号。例如，日志条目可以是“set x=5”，在第一个任期内添加的日志条目任期号为1。

7. **提交索引（Commit Index）**：已被大多数节点复制并可以安全应用到状态机的最高日志条目的索引。例如，提交索引为5表示前5个日志条目已被大多数节点复制并可以应用到状态机。

8. **最后应用索引（Last Applied Index）**：已经应用到状态机的最高日志条目的索引。例如，最后应用索引为5表示前5个日志条目已应用到状态机。

9. **心跳（Heartbeat）**：领导者定期发送给追随者的消息，用于维持领导者地位并防止追随者发起选举。心跳信息通常是空的附加日志请求。

10. **投票请求（Request Vote）**：候选者发起的选举请求，包含候选者的任期号、日志信息等。例如，当一个节点变为候选者时，它会向其他节点发送请求，请求其他节点投票支持它成为领导者。

# Raft算法的重要过程

## 选举过程

- **超时转换为候选者**：
  - 追随者在选举超时后转换为候选者，增加当前任期号，并发起投票请求。例如，如果一个追随者在规定时间内没有接收到领导者的心跳消息，它会变成候选者，增加任期号并发起投票请求。

- **发起投票请求**：
  - 候选者向其他节点发送投票请求，包含自己的任期号和日志信息。例如，候选者节点A向节点B和C发送投票请求，请求B和C投票支持它成为领导者。

- **响应投票请求**：
  - 节点接收到投票请求后，如果请求者的任期号较大且日志最新，则投票支持。例如，节点B和C接收到节点A的投票请求后，发现A的任期号较大且日志最新，于是投票支持A。

- **当选领导者**：
  - 候选者收到大多数节点的投票支持后，当选为领导者，开始发送心跳信息。例如，节点A收到B和C的投票支持后，成为领导者，并开始向B和C发送心跳信息。

## 日志复制过程

- **领导者接收命令**：
  - 客户端发送命令给领导者，领导者将命令作为新的日志条目追加到日志中。例如，客户端发送命令“set x=5”给领导者A，A将此命令作为新的日志条目追加到日志中。

- **日志复制**：
  - 领导者并行地将日志条目发送给所有追随者。例如，领导者A将新的日志条目“set x=5”发送给追随者B和C。

- **日志一致性检查**：
  - 追随者在接收到日志条目后进行一致性检查，确认日志条目的任期号和索引号。例如，追随者B和C接收到日志条目后，检查其任期号和索引号，确保日志条目的一致性。

- **日志应用**：
  - 当一个日志条目被大多数节点复制后，领导者将其标记为已提交，并通知追随者应用该日志条目到状态机。例如，当日志条目“set x=5”被B和C确认复制后，领导者A将其标记为已提交，并通知B和C应用该日志条目到状态机。

## 心跳过程

- **发送心跳**：
  - 领导者定期（通常间隔几百毫秒）发送心跳信息（空的附加日志请求）给追随者，以维持其领导者地位。例如，领导者A每隔几百毫秒发送空的附加日志请求给追随者B和C，作为心跳信息。

- **防止选举超时**：
  - 追随者在接收到心跳信息后，重置选举超时计时器，防止发起新的选举。例如，追随者B和C接收到领导者A的心跳信息后，重置选举超时计时器，不会发起新的选举。

## 日志提交

- **日志复制确认**：
  - 领导者在接收到大多数节点对日志条目的确认后，更新提交索引。例如，领导者A在接收到B和C对日志条目“set x=5”的确认后，更新提交索引。

- **通知追随者提交**：
  - 领导者将新的提交索引发送给追随者，通知他们将相应的日志条目应用到状态机。例如，领导者A将新的提交索引发送给追随者B和C，通知他们应用日志条目“set x=5”到状态机。

- **状态机应用**：
  - 追随者在接收到提交索引更新后，将日志条目应用到状态机。例如，追随者B和C在接收到新的提交索引后，将日志条目“set x=5”应用到状态机。
